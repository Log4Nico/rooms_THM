<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MemLabs - 2 - Writeup Log4Nico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div class="container">
        <h1>MemLabs - 2 - Write-Up</h1>
        <p>En este write-up, me adentro en los retos de <a href="https://github.com/stuxnet999/MemLabs">MemLabs</a>, una serie de laboratorios diseñados para poner a prueba 
          nuestras habilidades en el análisis de volcados de memoria. Equipado con <b>Volatility</b>, una de las herramientas 
          más potentes para diseccionar sistemas vivos o caídos, iré desenterrando credenciales, procesos sospechosos, 
          conexiones de red y cualquier pista que hayan dejado atrás.</p>

        <p>En esta ocasión nos encontramos delante del segundo reto del laboratiorio: <a href="https://github.com/stuxnet999/MemLabs/tree/master/Lab%202">MemLabs Lab 2 - A New World</a>.
          Este desafio supone una dificultad fácil, igual que el anterior, por lo que no tendría que suponernos ningún problema.</p>

        <h2>Enunciado</h2>

        <p>Uno de los clientes de nuestra empresa perdió el acceso a su sistema debido a un error desconocido. Supuestamente, es un activista 
          "ambiental"(traducción de "environmental") muy conocido. Como parte de la investigación, nos comentó que sus aplicaciones de uso habitual son los navegadores, 
          sus gestores de contraseñas, etc. Esperamos que puedas analizar este volcado de memoria, encontrar su información importante y devolvérnosla.</p>
        
        <h2>¿Qué sacamos en claro?</h2>
        <ul>
          <li>Activista "ambiental"(variables de entorno).</li>
          <li>Usaba el navegador.</li>
          <li>Usaba gestores de contraseña.</li>
        </ul>

        <p>Además, este reto consta de 3 flags.</p>

        <h2>Análisis del perfil</h2>
        
        <p>Para sacar la memoria debemos usar el siguiente comando:</p>

        <code>vol.py -f MemoryDump_Lab2.raw imageinfo</code>

        <p>Al hacer esto, nos saldrá lo siguiente:</p>

        <img src="img/image.png" alt="Perfiles">

        <p>Yo me quedaré con el perfil <b>Win7SP1x64</b>, ya que creo recordar que usa siempre el mismo sistema, por lo que el perfil siempre es el mismo.</p>
        
        <h2>Análisis de la memoria</h2>

        <p>Como dije antes, debemos encontrar 3 flags con las pistas que nos deba el enunciado. Así que vamos a encontrarlas.</p>
        
        <h3>Variables de entorno</h3>

        <p>En esta ocasión no tengo nada con lo que filtrar la busqueda, por lo que toca buscar a mano. Por suerte para nosotros, esta línea se repite mucho:</p>

        <img src="img/image-1.png" alt="envars">

        <pre>Para hacer la busqueda usé el parámetro <b>envars</b>.</pre>

        <p>La frase está cifrada en base64, y se trata de la primera flag del reto.</p>

        <img src="img/image-2.png" alt="primera flag">

        <h3>Navegador y Gestor de contraseña</h3>

        <p>Con navegadores podemos entender 2 cosas: buscadores como <b><i>chrome, edge, opera, etc.</i></b> o el propio navegador del sistema, <b><i>el explorador de archivos</i></b>.</p>
        <p>Veamos las 2 posibilidades. Empecemos viendo los procesos activos e intentar ver el navegador(internet) que usaba:</p>

        <img src="img/image-3.png" alt="pslist">

        <pre>Para ver los procesos podemos usar <b>pslist, pstree o psscan</b></pre>

        <p>Encontramos cosas muy interesantes en los procesos. Entre ellas que usaba el navegador Google Chrome y el gestor de contraseñas KeePass</p>

        <p>Ahora podemos analizar el explorardor de archivos, para ello usamos el siguiente comando:</p>

        <code>vol.py -f MemoryDump_Lab2.raw --profile=Win7SP1x64 iehistory</code>
        
        <img src="img/image-4.png" alt="iehistory">

        <p>Encontramos 3 archivos interesantes, pero uno de ellos el primero no se encuentra cargado en memoria, puede que sea de otro reto.</p>

        <p>Vamos a descargarnos los 2 archivos y ver que contienen:</p>

        <img src="img/image-5.png" alt="dumpeo">

        <p>Encontramos una contraseña en el archivo <b>Password.png</b>:</p>

        <img src="img/image-6.png" alt="password">
        
        <pre>No sabemos para qué podríamos usarla pero la guardamos.</pre>

        <p>El archivo <i>Hidden.kdbx</i> es como un excel, son tablas en las que guardas contraseñas, obviamente cifradas por una contraseña maestra.</p>
        <p>Para poder abrir el archivo, necesitaremos instalarnos el mismo gestor de contraseñas que usaban en la máquina <i>KeePass</i></p>

        <img src="img/image-7.png" alt="KeePass">

        <p>Al abrirlo, nos pedirá una contraseña, que obviamente, es la que encontramos antes.</p>

        <img src="img/image-8.png" alt="Segunda flag">

        <p>Dentro de la papelera, encontraremos la segunda flag del reto.</p>

        <p>Y por último, nos queda buscar en el navegador, para ello necesitaremos extraer el historial de navegación de Chorme, para ellos podemos usar el siguiente comando con filtro:</p>

        <code>vol.py -f MemoryDump_Lab2.raw --profile=Win7SP1x64 filescan | grep "History"</code>

        <img src="img/image-9.png" alt="Buscar historial">

        <p>El señalado es el que nos interesa, es la base de datos del historial del navegador. Lo extraemos y lo abrimos con <i>sqlitebrowser</i>:</p>

        <img src="img/image-10.png" alt="sqlitebrowser">

        <p>Para ver el historial, debemos irnos a <i>Browse Data</i>, y aquí dentro, elegir la tabla <i>urls</i>:</p>

        <img src="img/image-11.png" alt="Historial">

        <p>Encontraremos un enlace de <i>mega</i> el cual contiene un archivo llamado <b>important.zip</b> que, al intentar descomprimir, nos devuelve el siguiente mensaje:</p>

        <img src="img/image-12.png" alt="descomprimir">

        <p>La contraseña del zip es el SHA1 de la tercera flag del reto anterior</p>

        <img src="img/image-13.png" alt="Tercera flag">

        <p>Ya habríamos terminado con laboratorio 2 y damos pie a los desafíos más <i>complejos</i>. Con este reto hemos aprendido a usar el módulo <i>iehistory</i>, 
          el cual permite identificar las URLs visitadas, archivos descargados y actividad web relevante para análisis forense.</p>
        
        <a href="../Memlabs - Lab 1/index.html">Ir al laboratorio anterior</a> <br>
        <a href="../Memlabs - Lab 3/index.html">Ir al siguiente laboratorio</a>
    </div>
</body>
</html>
