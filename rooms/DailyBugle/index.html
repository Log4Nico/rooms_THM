<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Daily Bugle - Writeup Log4Nico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div class="container">
    <h1>Daily Bugle</h1>

    <div class="section">
      <h2>Análisis</h2>
      <p>Empezamos la máquina con un escaneo de puertos:</p>
      <img src="img/image.png" alt="Escaneo de puertos">

      <p>Vemos varios puertos abiertos: 22 (OpenSSH 7.4), 80 (Apache httpd 2.4.6) y 3306 (mariadb).</p>
      <p>Empezamos explorando el puerto 80:</p>
      <img src="img/image-1.png" alt="Página principal">

      <p>A simple vista vemos una página de noticias con Spiderman y un login. Hacemos un fuzzeo de directorios:</p>
      <img src="img/image-3.png" alt="Fuzzing directorios">

      <p>Mientras tanto, analizamos las tecnologías de la página:</p>
      <img src="img/image-2.png" alt="Tecnologías página">

      <p>El sitio utiliza el CMS <strong>Joomla</strong> y PHP.</p>
      <p>En <code>/administrator</code> encontramos el login de Joomla:</p>
      <img src="img/image-4.png" alt="Login Joomla">

      <p>Escaneamos la versión instalada de Joomla:</p>
      <img src="img/image-5.png" alt="Joomscan 1">
      <img src="img/image-6.png" alt="Joomscan 2">
      <img src="img/image-7.png" alt="Joomscan 3">
      <blockquote>
        Herramienta usada: <code>joomscan -u URL</code> para identificar versión y archivos por defecto.
      </blockquote>
    </div>

    <div class="section">
      <h2>Obteniendo la contraseña de Jonah</h2>
      <p>Nos piden buscar la contraseña hasheada de Jonah sin usar sqlmap. Usamos el <a href="https://github.com/teranpeterson/Joomblah" target="_blank">script Joomblah</a>:</p>
      <img src="img/image-8.png" alt="Joomblah script">

      <p>El script nos da el hash de la contraseña, debemos crackearlo:</p>
      <ol>
        <li>Identificamos el tipo de hash.</li>
        <li>Guardamos el hash en un archivo.</li>
        <li>Realizamos ataque por diccionario.</li>
      </ol>
      <img src="img/image-9.png" alt="John the Ripper hash">
      <img src="img/image-10.png" alt="Contraseña Jonah encontrada">

      <p>Con la contraseña de Jonah podemos iniciar sesión como administrador:</p>
      <img src="img/image-11.png" alt="Login admin">
      <img src="img/image-12.png" alt="Panel Joomla admin">
    </div>

    <div class="section">
      <h2>Reverse Shell y acceso al sistema</h2>
      <p>Ahora que somos superusuarios en la web, intentamos modificar un archivo del template para cargar una <a href="https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php" target="_blank">reverse shell</a>:</p>
      <img src="img/image-13.png" alt="Editar template">
      <img src="img/image-14.png" alt="Insertar reverse shell">
      <img src="img/image-15.png" alt="Configurar reverse shell">

      <p>Guardamos los cambios y ponemos el template modificado por defecto:</p>
      <img src="img/image-17.png" alt="Template por defecto">

      <p>Ponemos el puerto en escucha con <code>nc -lvp 1234</code> y accedemos a una URL para disparar la shell:</p>
      <img src="img/image-16.png" alt="Trigger reverse shell">
      <img src="img/image-18.png" alt="Ruta template">
      <img src="img/image-19.png" alt="Shell obtenida">

      <pre>Ya estaríamos dentro del sistema con el usuario web <b>apache</b></pre>
    </div>

    <div class="section">
      <h2>Escalada de privilegios</h2>
      <p>Buscamos la <code>user.txt</code> y vemos que debemos escalar privilegios para ser usuarios normales primero:</p>
      <img src="img/image-20.png" alt="Buscar user.txt">

      <p>Revisamos los usuarios del sistema:</p>
      <img src="img/image-23.png" alt="Usuarios del sistema">
      <blockquote>Usuarios encontrados: <span class="flag">jjameson</span> y <span class="flag">root</span></blockquote>

      <p>Vemos los archivos en <code>/var/www/html</code>:</p>
      <img src="img/image-21.png" alt="Archivos webroot">

      <p>En el archivo de configuración encontramos una contraseña:</p>
      <img src="img/image-22.png" alt="Contraseña encontrada">
      <blockquote>Contraseña: <span class="flag">nv5uz9r3ZEDzVjNu</span></blockquote>

      <p>Probamos iniciar sesión con estas credenciales:</p>
      <img src="img/image-24.png" alt="SSH login">

      <pre>La contraseña era de jjameson</pre>

      <p>Vemos los permisos de <code>jjameson</code>:</p>
      <img src="img/image-26.png" alt="sudo -l jjameson">

      <p>El usuario puede ejecutar <code>yum</code> como root. Usamos <a href="https://gtfobins.github.io/gtfobins/yum/" target="_blank">GTFOBins</a> para escalar privilegios:</p>
      <img src="img/image-27.png" alt="GTFOBins yum">
      <pre>Simplemente copiamos y pegamos en la terminal</pre>

      <img src="img/image-28.png" alt="Escalada yum">

      <p>Hemos pasado de un usuario web, a un usuario del sistema y acabamos con el usuario root.</p>
    </div>
  </div>
</body>
</html>
