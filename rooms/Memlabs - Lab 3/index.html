<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MemLabs - 3 - Writeup Log4Nico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div class="container">
        <h1>MemLabs - 3 - Write-Up</h1>
        <p>En este write-up, me adentro en los retos de <a href="https://github.com/stuxnet999/MemLabs">MemLabs</a>, una serie de laboratorios diseñados para poner a prueba 
          nuestras habilidades en el análisis de volcados de memoria. Equipado con <b>Volatility</b>, una de las herramientas 
          más potentes para diseccionar sistemas vivos o caídos, iré desenterrando credenciales, procesos sospechosos, 
          conexiones de red y cualquier pista que hayan dejado atrás.</p>

        <p>Continuamos con los desafíos de Forensic Ram. En esta ocasión nos encontramos ante <a href="https://github.com/stuxnet999/MemLabs/tree/master/Lab%203">MemLabs Lab 3 - The Evil’s Den</a>.
          Este reto supone una dificultad media, empezando así con los retos un poco más complejos.</p>

        <h2>Enunciado</h2>

        <p>Un script malicioso a encriptado una información muy secreta que tenía en mi sistema. ¿Puedes recuperarla por favor?</p>
        
        <h2>¿Qué sacamos en claro?</h2>
        <ul>
          <li>Script malicioso(probablemente se ejecutó por consola).</li>
          <li>Información secreta(Mirar archivos).</li>
        </ul>

        <p>Además, este reto consta de 1 flag dividia en 2 partes, y para resolverlo necesitaremos la herramienta de estenografía <i>steghide</i>.</p>

        <h2>Análisis del perfil</h2>
        
        <p>Para sacar la memoria debemos usar el siguiente comando:</p>

        <code>vol.py -f MemoryDump_Lab3.raw imageinfo</code>

        <p>Al hacer esto, nos saldrá lo siguiente:</p>

        <img src="img/image.png" alt="Perfiles">

        <p>Como ya he dicho varias veces, podemos usar cualquira de estas.</p>
        
        <h2>Análisis de la memoria</h2>

        <p>Dividir este análisis en secciones es una tarea complicada, ya que el enunciado nos ha dicho más bien poco. Lo haré según los puntos que saqué antes.</p>
        
        <h3>script malicioso</h3>

        <p>Buscar archivos así a lo loco sin nada con lo que filtrar es una perdida de tiempo. Sabemos que estamos buscando un script, pero no sabemos la extensión. Aún así, sabemos
          que los scripts se tienen que ejecutar por consola, por lo que podemos primero hacer un listado de los comandos que se ejecutaron:</p>

        <img src="img/image-1.png" alt="cmdline">

        <pre>Para hacer la busqueda usé el parámetro <b>cmdline</b>.</pre>

        <p>Vaya, <b>NOTEPAD.EXE</b> ejecutó evilscript.py y vip.txt. Ya tenemos 2 cosas que buscar, hagamoslo con un <i>filescan</i>:</p>

        <img src="img/image-2.png" alt="filescan">

        <p>Vemos los 2 archivos están cargados en memoria, lo cual significa que podemos extraerlos y ver su contenido:</p>

        <img src="img/image-3.png" alt="dumpfile">

        <p>Si analizamos el script, veremos que su función es cifrar un archivo con el método xor y volverlo a cifrar en base64:</p>

        <img src="img/image-4.png" alt="script">

        <p>No supone un reto muy complejo, además que podemos descifrarlo muy fácilmente con cyberchef y encontrar así la primera mitad de la flag:</p>

        <img src="img/image-5.png" alt="Primera mitad">

        <h3>Problema</h3>

        <p>Si, tenemos un problema. Las 2 <i>pistas</i> del enunciado las acabamos de gastar en el apartado anterior. Igualmente, como necesitamos la herramienta <i>steghide</i>, asumo queda
          debemos buscar una imagen, esto debido a que la herramienta permite <i>esconder</i> cosas en imágenes.</p>

        <p>Vamos a intentar hacer eso, a ver qué encontramos:</p>

        <img src="img/image-6.png" alt="Busqueda">

        <pre>Podría haber filtrado por extensiones también, como jpg, jpeg, etc.</pre>

        <p>Encontramos un archivo sospechoso en el escritorio del usuario, obviamente lo extraemos y lo analizamos.</p>

        <img src="img/image-7.png" alt="mmmh...">

        <pre>mmh...</pre>

        <img src="img/image-8.png" alt="info">

        <p>En la imagen vemos un intento de sacar información del archivo. Sin embargo, nos dice que la contraseña es incorrecta. Como dato, si la herramienta nos pide una contraseña, 
          significa que, efectivamente, el archivo tiene algo escondido. Si usamos la primera mitad de la flag como contraseña en steghide, podremos extraer la segunda mitad de la flag, completando así el reto.</p>

        <p>Aunque no lo parezca, hemos aprendido varias cosas con este reto. Lo primero es que un atacante puede cambiar el nombre a programas para <i>intentar</i> pasar desapercibido.
          Probablemente, ese <i>NOTEPAD.EXE</i> sea realmente <i>python.exe</i>. Hemos visto como funciona un malware, aunque sí que es cierto que fue uno muy básico. Y por último,
          hemos visto la herramienta <i>steghide</i>, muy común en retos ctfs</p>
        
        <a href="../Memlabs - Lab 2/index.html">Ir al laboratorio anterior</a> <br>
        <a href="../Memlabs - Lab 4/index.html">Ir al siguiente laboratorio</a>
    </div>
</body>
</html>
